# Registro de Sesión - 21 de Enero 2026

## Resumen General
Mejoras visuales y funcionales en la página de producto individual de Duendes del Uruguay.

---

## Archivo Principal Modificado

**Archivo:** `duendes-experiencia-magica.php`
**Ubicación local:** `/tmp/duendes-experiencia-magica.php`
**Ubicación servidor:** `/home/wplive/web/wp-live/wp-content/mu-plugins/duendes-experiencia-magica.php`

---

## Cambios Realizados

### 1. Header del Tema WordPress
- **Antes:** Header personalizado con código propio
- **Después:** Usa `get_header()` para mantener consistencia con el resto del sitio

### 2. Footer del Tema WordPress
- **Antes:** Footer duplicado con código HTML personalizado
- **Después:** Usa `get_footer()` para el footer del tema

### 3. Colores NEON por Categoría y Género

| Categoría | Masculino | Femenino |
|-----------|-----------|----------|
| Protección | `#00D4FF` (Cyan neon) | `#BF5FFF` (Violeta neon) |
| Amor | `#FF0080` (Magenta neon) | `#FF69B4` (Rosa neon) |
| Abundancia | `#FFD700` (Dorado neon) | `#FFEA00` (Amarillo neon) |
| Salud | `#39FF14` (Verde neon) | `#00FFFF` (Cyan neon) |
| Sabiduría | `#BF5FFF` (Violeta neon) | `#FF00FF` (Magenta neon) |

### 4. Sección Historia
- Ahora se muestra en **bloques flotantes separados** apilados verticalmente
- Cada párrafo es un bloque independiente con animación de flotación
- Borde izquierdo con color de la categoría

### 5. Sección "Que Incluye Tu Pacto"
- Título con **efecto de luz neon deslizante**
- Fondo con **orbes animados** sutiles
- Cada elemento resaltado con hover effects

### 6. Características del Guardián
- **Eliminado:** Referencias a "pieza única" (los guardianes son seres con vida)
- **Cambiado:** "Pieza Única" → "Ser Único/a" (según género)
- **Cambiado:** Box de "Articulada" ahora dice:
  - Título: "Articulad@" (según género)
  - Subtítulo: "CAMBIA DE POSICIONES"

### 7. Terminología Actualizada
- "PIEZAS UNICAS CANALIZADAS" → "SERES UNICOS CANALIZADOS"
- "PIEZA UNICA" → "SER UNICO"
- Toda referencia a "pieza" eliminada - son seres con vida

### 8. Animaciones Agregadas
- Historia: bloques flotantes con `blockFloat`
- Ficha del guardián: hover con scale y glow
- Frase/lema: iluminación animada
- Dato curioso: destacado visual
- Sus dones: animación de entrada
- Testimonios: fondo con gradiente animado
- Título "Que Incluye": efecto `neonSlide`

### 9. Visibilidad Corregida
- Secciones ahora tienen `opacity: 1` por defecto
- "Su mensaje para vos" visible correctamente
- Testimonios en posición correcta (antes del FAQ)

---

## Archivos de Utilidad en el Servidor

| Archivo | URL | Clave |
|---------|-----|-------|
| Limpiar caché total | `/limpiar-todo-cache.php` | `duendes2024limpiar` |
| Limpiar OPcache | `/clear-opcache.php` | `duendes2024clear` |
| Debug Violeta | `/debug-violeta.php` | `duendes2024debug` |

**Ejemplo de uso:**
```
https://duendesdeluruguay.com/limpiar-todo-cache.php?key=duendes2024limpiar
```

---

## Credenciales SFTP

```
Host: 34.70.139.72
Puerto: 55309
Usuario: sftp_live_WfP6i
Contraseña: JzflrSheUnj4itUE27Aqr0SgD3cG5LXhCR
```

---

## Sistema Dinámico

Todo el contenido se genera dinámicamente basado en:

1. **Categoría del producto** → Define colores y configuración
2. **Género del guardián** → Define variante de color (masculino/femenino)
3. **Meta datos del producto:**
   - `_duendes_ficha` → Datos estructurados (altura, género, frase, dato curioso, etc.)
   - `_duendes_historia` → Historia del guardián
   - `_duendes_tipo` → Tipo de guardián
   - `_duendes_genero` → Género
   - `_duendes_elemento` → Elemento

---

## Estado Actual

- Página de producto funcionando con diseño NEON
- Header y footer del tema WordPress integrados
- Todas las secciones visibles y animadas
- Terminología corregida (sin "pieza")
- Colores adaptándose por categoría y género
- Caché limpiado en servidor

---

## Actualización ~23:09 - Sistema de Sonidos Mágicos

### Archivo Modificado

**Archivo:** `duendes-tienda-magica.php`
**Ubicación local:** `/Users/usuario/Desktop/duendes-vercel/wordpress-plugins/duendes-tienda-magica.php`
**Ubicación servidor:** `/home/wplive/web/wp-live/wp-content/mu-plugins/duendes-tienda-magica.php`

### Cambios Realizados

#### 1. Corrección de Terminología en Tienda
- **Antes:** "Piezas unicas. Cuando uno se va, desaparece para siempre."
- **Después:** "Seres unicos. Cuando uno se va, desaparece para siempre."

#### 2. Sistema de Sonidos con Web Audio API

**Sonido al seleccionar/hover guardián:**
- Campana suave con tono dulce (La5 → Mi6)
- Armónicos adicionales para sonido más rico
- Fade in: 0.05s
- Fade out: 0.6s (suave y largo)
- Volumen bajo (0.08) para no molestar
- Throttle de 150ms para no sobrecargar

**Sonido al agregar al carrito:**
- Acorde mayor ascendente (Do5 → Mi5 → Sol5 → Do6)
- Cada nota con delay de 80ms (efecto arpegio)
- Shimmer/brillo adicional al final (Do7)
- Fade in y fade out suaves en cada nota
- Genera sensación positiva de "logro"

**Características técnicas:**
- Web Audio API (sin archivos externos)
- Funciona en tienda, categorías y página de producto
- Se activa solo después de interacción del usuario (políticas de navegador)
- Funciones expuestas globalmente: `window.duendesSounds.select()` y `window.duendesSounds.addToCart()`
- Compatible con AJAX de WooCommerce (evento `added_to_cart`)

### Eventos que Disparan Sonidos

| Evento | Sonido | Descripción |
|--------|--------|-------------|
| Hover en producto (tienda) | Select | Campana suave |
| Click en "Agregar al carrito" | Add to Cart | Acorde ascendente |
| AJAX añadido al carrito | Add to Cart | Acorde ascendente |

---

---

## Actualización ~19:15 - Sistema Emails Post-Compra

### Archivo Creado

**Archivo:** `/app/api/emails/post-compra/route.js`
**Ubicación local:** `/Users/usuario/Desktop/duendes-vercel/app/api/emails/post-compra/route.js`

### Secuencia de 7 Emails

| # | Tipo | Delay | Propósito |
|---|------|-------|-----------|
| 1 | confirmacion | Inmediato | "Tu guardián te eligió" - confirmación emocional |
| 2 | certificado | 24h | Entrega certificado de canalización |
| 3 | envio | Al enviar | "Comenzó su viaje" + tracking |
| 4 | dia3 | 3 días | "¿Ya notaste algo diferente?" + diario de señales |
| 5 | dia7 | 7 días | Pedir testimonio |
| 6 | dia14 | 14 días | Cross-sell guardianes afines (con cierre adaptativo) |
| 7 | dia30 | 30 días | Invitación al Círculo + 30 días gratis |

### Características

- Integración con sistema de cierres adaptativos (5 perfiles)
- URLs dinámicas para certificado, tracking, Mi Magia
- Guardianes sugeridos por afinidad
- Guarda secuencia en Vercel KV (TTL 45 días)
- Health check en GET
- Tono rioplatense, cálido, no invasivo

### Endpoint

```
POST /api/emails/post-compra
{
  "email": "usuario@email.com",
  "nombre": "María",
  "guardian_nombre": "Thornwood",
  "guardian_genero": "m",
  "order_number": "12345",
  "tracking_url": "https://...",
  "perfil": "vulnerable",
  "guardianes_sugeridos": [...]
}
```

---

## Próximos Pasos Pendientes

- [ ] FAQ: actualizar información sobre certificado y regalo
- [ ] Revisar responsive en móviles
- [ ] Testear con diferentes productos/categorías
- [ ] Testear sonidos en diferentes navegadores
- [x] Crear generador de certificados PDF (TAREA B) - HECHO
- [ ] Verificar DHL Express (TAREA C)

---

## Actualización ~19:50 - Generador de Certificados

### Archivo Creado

**Archivo:** `/app/api/certificado/route.js`

### Funcionalidades

**GET `/api/certificado?order=12345`**
- Genera certificado HTML elegante optimizado para impresión
- Diseño A4 con bordes dorados, esquinas decorativas
- Incluye: nombre guardián, nombre humano, mensaje canalizado
- QR dinámico que lleva a Mi Magia
- Número de certificado único (DU-2026-XXXXXX)
- Botón "Imprimir / Guardar PDF" (desaparece al imprimir)

**GET con `?format=json`**
- Devuelve datos del certificado en JSON

**POST**
- Guarda datos de canalización en Vercel KV
- Para uso desde webhook de WooCommerce

### Características del Certificado

- Tipografías: Cinzel + Cormorant Garamond
- Colores: Dorado (#C6A962), crema (#FAF8F5)
- Secciones: Header, nombre guardián, nombre humano, mensaje, detalles, sincrodestino, firma Thibisay, QR
- Sin dependencias externas (usa API pública para QR)
- Compatible con impresión directa del navegador

---

## Actualización ~20:00 - Verificación DHL Express

### Estado del Plugin

| Item | Estado |
|------|--------|
| Plugin | `woocommerce-dhlexpress-services` v3.0.2 |
| API Key | Configurada (`240aa8d4...0867`) |
| Habilitado | Sí |
| Proveedor API | StarShipIT |

### Problema Detectado

DHL Express no estaba asignado a ninguna zona de envío:
- "ENVIOS DENTRO DE URUGUAY" → Solo tarifa plana
- "Resto del mundo" → Sin métodos

### Productos sin Peso

- 23 de 123 productos no tienen peso configurado
- DHL necesita peso para calcular tarifas

### Configuración Aplicada

| Zona | Método | Instance ID | Estado |
|------|--------|-------------|--------|
| Resto del mundo (Zone 0) | DHL Express | 4 | Habilitado |
| Uruguay (Zone 1) | Tarifa Fija (DAC) | existente | Habilitado |

**Acciones realizadas:**
- DHL Express agregado a zona global (method_id='dhlexpress')
- API Key copiada desde configuración existente
- Cache de envíos limpiado

**Pendiente manual:**
- Configurar peso en 23 productos que no lo tienen

---

## Notas Técnicas

- El archivo `duendes-experiencia-magica.php` es un mu-plugin (se carga automáticamente)
- Hook principal: `template_redirect` para interceptar páginas de producto
- Usa `get_header()` y `get_footer()` para integración con tema
- CSS embebido con variables PHP para colores dinámicos

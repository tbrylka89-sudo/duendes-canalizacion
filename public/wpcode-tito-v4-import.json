[
  {
    "id": 9999,
    "title": "ğŸ€ TITO Ã‰PICO v4.0 - Widget Unificado (Reemplaza todos los snippets de Tito anteriores)",
    "code": "<!--\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ€ TITO Ã‰PICO - WIDGET UNIFICADO PARA WORDPRESS\nVersiÃ³n: 4.0 (Enero 2026)\n\nINSTRUCCIONES:\n1. CopiÃ¡ TODO este cÃ³digo\n2. En WordPress â†’ WPCode â†’ Add New Snippet\n3. Tipo: HTML Snippet\n4. Location: Site Wide Footer\n5. Activar y guardar\n\nFEATURES:\nâœ“ Productos con FOTOS en el chat\nâœ“ Burbujas proactivas inteligentes por pÃ¡gina\nâœ“ DetecciÃ³n de abandono de carrito\nâœ“ ConexiÃ³n con WooCommerce en tiempo real\nâœ“ Ayuda para finalizar compra\nâœ“ Memoria del visitante\nâœ“ GalerÃ­a deslizable de productos\nâœ“ Responsive completo\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n-->\n\n<style>\n@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Cormorant+Garamond:ital,wght@0,400;0,500;1,400&display=swap');\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   VARIABLES\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n:root {\n    --tito-dorado: #d4af37;\n    --tito-dorado-claro: #e6c860;\n    --tito-dorado-oscuro: #b8960c;\n    --tito-negro: #0a0a0a;\n    --tito-negro-suave: #1a1a1a;\n    --tito-blanco: rgba(255,255,255,0.9);\n    --tito-blanco-suave: rgba(255,255,255,0.6);\n}\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   CONTENEDOR PRINCIPAL\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n.tito-widget {\n    position: fixed !important;\n    bottom: 25px !important;\n    right: 25px !important;\n    z-index: 999999 !important;\n    font-family: 'Cormorant Garamond', Georgia, serif !important;\n}\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   BOTÃ“N FLOTANTE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n.tito-toggle {\n    width: 75px !important;\n    height: 75px !important;\n    background: linear-gradient(135deg, var(--tito-negro-suave) 0%, var(--tito-negro) 100%) !important;\n    border: 2px solid var(--tito-dorado) !important;\n    border-radius: 50% !important;\n    cursor: pointer !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    box-shadow: 0 5px 30px rgba(0,0,0,0.4), 0 0 25px rgba(212,175,55,0.25) !important;\n    transition: all 0.3s ease !important;\n    position: relative !important;\n    animation: titoFloat 3s ease-in-out infinite !important;\n    padding: 0 !important;\n    overflow: hidden !important;\n}\n\n.tito-toggle img {\n    width: 100% !important;\n    height: 100% !important;\n    object-fit: cover !important;\n    border-radius: 50% !important;\n}\n\n.tito-toggle:hover {\n    transform: scale(1.1) !important;\n    animation: none !important;\n    box-shadow: 0 8px 40px rgba(0,0,0,0.5), 0 0 40px rgba(212,175,55,0.4) !important;\n}\n\n@keyframes titoFloat {\n    0%, 100% { transform: translateY(0); }\n    50% { transform: translateY(-6px); }\n}\n\n/* NotificaciÃ³n */\n.tito-notif {\n    position: absolute !important;\n    top: -5px !important;\n    right: -5px !important;\n    width: 24px !important;\n    height: 24px !important;\n    background: var(--tito-dorado) !important;\n    color: var(--tito-negro) !important;\n    font-size: 12px !important;\n    font-weight: 700 !important;\n    border-radius: 50% !important;\n    display: none;\n    align-items: center !important;\n    justify-content: center !important;\n    animation: titoPulse 2s infinite !important;\n}\n\n@keyframes titoPulse {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.15); }\n}\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   BURBUJA PROACTIVA\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n.tito-burbuja {\n    position: absolute !important;\n    bottom: 95px !important;\n    right: 0 !important;\n    width: 320px !important;\n    background: linear-gradient(135deg, var(--tito-negro-suave), var(--tito-negro)) !important;\n    border: 1px solid rgba(212,175,55,0.4) !important;\n    border-radius: 18px !important;\n    padding: 18px 20px !important;\n    box-shadow: 0 15px 50px rgba(0,0,0,0.5), 0 0 25px rgba(212,175,55,0.15) !important;\n    opacity: 0 !important;\n    visibility: hidden !important;\n    transform: translateY(15px) scale(0.95) !important;\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;\n}\n\n.tito-burbuja.visible {\n    opacity: 1 !important;\n    visibility: visible !important;\n    transform: translateY(0) scale(1) !important;\n}\n\n.tito-burbuja::after {\n    content: '' !important;\n    position: absolute !important;\n    bottom: -10px !important;\n    right: 28px !important;\n    border-left: 10px solid transparent !important;\n    border-right: 10px solid transparent !important;\n    border-top: 10px solid var(--tito-negro-suave) !important;\n}\n\n.tito-burbuja-close {\n    position: absolute !important;\n    top: 10px !important;\n    right: 12px !important;\n    background: none !important;\n    border: none !important;\n    color: var(--tito-blanco-suave) !important;\n    font-size: 20px !important;\n    cursor: pointer !important;\n    padding: 0 !important;\n    line-height: 1 !important;\n    transition: color 0.2s !important;\n}\n\n.tito-burbuja-close:hover {\n    color: #fff !important;\n}\n\n.tito-burbuja-texto {\n    color: var(--tito-blanco) !important;\n    font-size: 15px !important;\n    line-height: 1.55 !important;\n    margin: 0 0 15px 0 !important;\n    padding-right: 25px !important;\n}\n\n.tito-burbuja-texto strong {\n    color: var(--tito-dorado-claro) !important;\n}\n\n/* Botones de burbuja */\n.tito-burbuja-botones {\n    display: flex !important;\n    gap: 10px !important;\n    flex-wrap: wrap !important;\n}\n\n.tito-burbuja-btn {\n    flex: 1 !important;\n    min-width: 100px !important;\n    background: rgba(212,175,55,0.12) !important;\n    border: 1px solid rgba(212,175,55,0.4) !important;\n    color: var(--tito-dorado) !important;\n    padding: 11px 14px !important;\n    border-radius: 25px !important;\n    font-family: 'Cormorant Garamond', serif !important;\n    font-size: 13px !important;\n    cursor: pointer !important;\n    transition: all 0.3s ease !important;\n    text-align: center !important;\n}\n\n.tito-burbuja-btn:hover {\n    background: rgba(212,175,55,0.22) !important;\n    border-color: var(--tito-dorado) !important;\n}\n\n.tito-burbuja-btn.primary {\n    background: linear-gradient(135deg, var(--tito-dorado), var(--tito-dorado-oscuro)) !important;\n    color: var(--tito-negro) !important;\n    border: none !important;\n    font-weight: 600 !important;\n}\n\n.tito-burbuja-btn.primary:hover {\n    box-shadow: 0 5px 20px rgba(212,175,55,0.4) !important;\n    transform: scale(1.02) !important;\n}\n\n/* Mini galerÃ­a en burbuja */\n.tito-burbuja-galeria {\n    display: flex !important;\n    gap: 10px !important;\n    margin-bottom: 15px !important;\n    overflow-x: auto !important;\n    padding-bottom: 5px !important;\n    scrollbar-width: none !important;\n}\n\n.tito-burbuja-galeria::-webkit-scrollbar {\n    display: none !important;\n}\n\n.tito-burbuja-producto {\n    flex-shrink: 0 !important;\n    width: 90px !important;\n    text-align: center !important;\n    cursor: pointer !important;\n    transition: transform 0.2s !important;\n}\n\n.tito-burbuja-producto:hover {\n    transform: scale(1.05) !important;\n}\n\n.tito-burbuja-producto img {\n    width: 80px !important;\n    height: 80px !important;\n    object-fit: cover !important;\n    border-radius: 10px !important;\n    border: 1px solid rgba(212,175,55,0.3) !important;\n}\n\n.tito-burbuja-producto-nombre {\n    font-size: 11px !important;\n    color: var(--tito-blanco-suave) !important;\n    margin-top: 5px !important;\n    white-space: nowrap !important;\n    overflow: hidden !important;\n    text-overflow: ellipsis !important;\n}\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   VENTANA DE CHAT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n.tito-window {\n    position: absolute !important;\n    bottom: 95px !important;\n    right: 0 !important;\n    width: 400px !important;\n    height: 580px !important;\n    background: linear-gradient(180deg, #12151a 0%, #0a0c10 100%) !important;\n    border: 1px solid rgba(212,175,55,0.3) !important;\n    border-radius: 25px !important;\n    overflow: hidden !important;\n    opacity: 0 !important;\n    visibility: hidden !important;\n    transform: translateY(20px) scale(0.95) !important;\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;\n    box-shadow: 0 30px 80px rgba(0,0,0,0.6) !important;\n    display: flex !important;\n    flex-direction: column !important;\n}\n\n.tito-window.visible {\n    opacity: 1 !important;\n    visibility: visible !important;\n    transform: translateY(0) scale(1) !important;\n}\n\n/* Header del chat */\n.tito-header {\n    background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.05)) !important;\n    border-bottom: 1px solid rgba(212,175,55,0.2) !important;\n    padding: 16px 20px !important;\n    display: flex !important;\n    align-items: center !important;\n    gap: 14px !important;\n}\n\n.tito-avatar {\n    width: 52px !important;\n    height: 52px !important;\n    border-radius: 50% !important;\n    overflow: hidden !important;\n    flex-shrink: 0 !important;\n    box-shadow: 0 0 15px rgba(212,175,55,0.35) !important;\n    border: 2px solid rgba(212,175,55,0.4) !important;\n}\n\n.tito-avatar img {\n    width: 100% !important;\n    height: 100% !important;\n    object-fit: cover !important;\n}\n\n.tito-info h4 {\n    font-family: 'Cinzel', serif !important;\n    font-size: 16px !important;\n    color: #fff !important;\n    font-weight: 600 !important;\n    margin: 0 0 3px 0 !important;\n}\n\n.tito-info p {\n    font-size: 13px !important;\n    color: var(--tito-blanco-suave) !important;\n    margin: 0 !important;\n    display: flex !important;\n    align-items: center !important;\n    gap: 6px !important;\n}\n\n.tito-status {\n    display: inline-block !important;\n    width: 8px !important;\n    height: 8px !important;\n    background: #4ade80 !important;\n    border-radius: 50% !important;\n    animation: titoStatusPulse 2s infinite !important;\n}\n\n@keyframes titoStatusPulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.5; }\n}\n\n.tito-close {\n    margin-left: auto !important;\n    background: none !important;\n    border: none !important;\n    color: var(--tito-blanco-suave) !important;\n    font-size: 28px !important;\n    cursor: pointer !important;\n    padding: 0 !important;\n    line-height: 1 !important;\n    transition: color 0.2s !important;\n}\n\n.tito-close:hover {\n    color: #fff !important;\n}\n\n/* Ãrea de mensajes */\n.tito-messages {\n    flex: 1 !important;\n    overflow-y: auto !important;\n    padding: 18px !important;\n    display: flex !important;\n    flex-direction: column !important;\n    gap: 14px !important;\n}\n\n.tito-messages::-webkit-scrollbar {\n    width: 5px !important;\n}\n\n.tito-messages::-webkit-scrollbar-thumb {\n    background: rgba(212,175,55,0.3) !important;\n    border-radius: 3px !important;\n}\n\n/* Mensajes */\n.tito-msg {\n    max-width: 85% !important;\n    padding: 13px 17px !important;\n    border-radius: 18px !important;\n    font-size: 15px !important;\n    line-height: 1.55 !important;\n    animation: titoMsgIn 0.3s ease !important;\n}\n\n@keyframes titoMsgIn {\n    from { opacity: 0; transform: translateY(10px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.tito-msg.bot {\n    background: rgba(212,175,55,0.1) !important;\n    border: 1px solid rgba(212,175,55,0.2) !important;\n    color: var(--tito-blanco) !important;\n    align-self: flex-start !important;\n    border-bottom-left-radius: 5px !important;\n}\n\n.tito-msg.user {\n    background: linear-gradient(135deg, var(--tito-dorado), var(--tito-dorado-oscuro)) !important;\n    color: var(--tito-negro) !important;\n    align-self: flex-end !important;\n    border-bottom-right-radius: 5px !important;\n}\n\n/* Typing indicator */\n.tito-msg.typing {\n    display: flex !important;\n    gap: 5px !important;\n    padding: 16px 22px !important;\n}\n\n.tito-msg.typing span {\n    width: 8px !important;\n    height: 8px !important;\n    background: var(--tito-dorado) !important;\n    border-radius: 50% !important;\n    animation: titoTyping 1.4s infinite !important;\n}\n\n.tito-msg.typing span:nth-child(2) { animation-delay: 0.2s !important; }\n.tito-msg.typing span:nth-child(3) { animation-delay: 0.4s !important; }\n\n@keyframes titoTyping {\n    0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }\n    30% { opacity: 1; transform: translateY(-5px); }\n}\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   GALERÃA DE PRODUCTOS EN CHAT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n.tito-galeria {\n    display: flex !important;\n    gap: 12px !important;\n    overflow-x: auto !important;\n    padding: 12px 0 !important;\n    margin-top: 10px !important;\n    scroll-behavior: smooth !important;\n    scrollbar-width: none !important;\n}\n\n.tito-galeria::-webkit-scrollbar {\n    display: none !important;\n}\n\n.tito-galeria-card {\n    flex-shrink: 0 !important;\n    width: 150px !important;\n    background: rgba(0,0,0,0.5) !important;\n    border: 1px solid rgba(212,175,55,0.3) !important;\n    border-radius: 14px !important;\n    overflow: hidden !important;\n    cursor: pointer !important;\n    transition: all 0.3s ease !important;\n    text-decoration: none !important;\n}\n\n.tito-galeria-card:hover {\n    border-color: var(--tito-dorado) !important;\n    transform: translateY(-4px) !important;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.4), 0 0 20px rgba(212,175,55,0.2) !important;\n}\n\n.tito-galeria-card img {\n    width: 150px !important;\n    height: 110px !important;\n    object-fit: cover !important;\n    display: block !important;\n    background: #222 !important;\n}\n\n.tito-galeria-info {\n    padding: 10px !important;\n}\n\n.tito-galeria-nombre {\n    font-family: 'Cinzel', serif !important;\n    font-size: 12px !important;\n    color: #fff !important;\n    margin: 0 0 5px 0 !important;\n    white-space: nowrap !important;\n    overflow: hidden !important;\n    text-overflow: ellipsis !important;\n}\n\n.tito-galeria-precio {\n    font-size: 14px !important;\n    color: var(--tito-dorado) !important;\n    font-weight: 600 !important;\n    margin: 0 !important;\n}\n\n.tito-galeria-btn {\n    display: block !important;\n    text-align: center !important;\n    background: rgba(212,175,55,0.2) !important;\n    color: var(--tito-dorado) !important;\n    font-size: 11px !important;\n    padding: 7px !important;\n    margin-top: 8px !important;\n    border-radius: 6px !important;\n    transition: background 0.2s !important;\n}\n\n.tito-galeria-card:hover .tito-galeria-btn {\n    background: rgba(212,175,55,0.35) !important;\n}\n\n.tito-galeria-hint {\n    font-size: 11px !important;\n    color: var(--tito-blanco-suave) !important;\n    text-align: center !important;\n    margin-top: 6px !important;\n    opacity: 0.7 !important;\n}\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   SUGERENCIAS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n.tito-suggestions {\n    padding: 0 18px 12px !important;\n    display: flex !important;\n    flex-wrap: wrap !important;\n    gap: 8px !important;\n}\n\n.tito-suggestion {\n    background: rgba(212,175,55,0.1) !important;\n    border: 1px solid rgba(212,175,55,0.25) !important;\n    border-radius: 20px !important;\n    padding: 8px 14px !important;\n    font-size: 13px !important;\n    color: var(--tito-blanco) !important;\n    cursor: pointer !important;\n    transition: all 0.2s !important;\n}\n\n.tito-suggestion:hover {\n    background: rgba(212,175,55,0.2) !important;\n    border-color: var(--tito-dorado) !important;\n}\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   INPUT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n.tito-input-container {\n    padding: 14px 18px 18px !important;\n    border-top: 1px solid rgba(212,175,55,0.2) !important;\n    display: flex !important;\n    gap: 10px !important;\n    background: rgba(0,0,0,0.3) !important;\n}\n\n.tito-input {\n    flex: 1 !important;\n    background: rgba(255,255,255,0.06) !important;\n    border: 1px solid rgba(212,175,55,0.3) !important;\n    border-radius: 25px !important;\n    padding: 13px 20px !important;\n    font-family: 'Cormorant Garamond', serif !important;\n    font-size: 16px !important;\n    color: #fff !important;\n    outline: none !important;\n}\n\n.tito-input::placeholder {\n    color: var(--tito-blanco-suave) !important;\n}\n\n.tito-input:focus {\n    border-color: var(--tito-dorado) !important;\n}\n\n.tito-send {\n    width: 50px !important;\n    height: 50px !important;\n    background: linear-gradient(135deg, var(--tito-dorado), var(--tito-dorado-oscuro)) !important;\n    border: none !important;\n    border-radius: 50% !important;\n    cursor: pointer !important;\n    font-size: 20px !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    flex-shrink: 0 !important;\n    transition: all 0.2s !important;\n}\n\n.tito-send:hover:not(:disabled) {\n    transform: scale(1.05) !important;\n    box-shadow: 0 5px 20px rgba(212,175,55,0.4) !important;\n}\n\n.tito-send:disabled {\n    opacity: 0.5 !important;\n    cursor: not-allowed !important;\n}\n\n/* Footer */\n.tito-footer {\n    text-align: center !important;\n    padding: 8px !important;\n    font-size: 10px !important;\n    color: rgba(255,255,255,0.25) !important;\n}\n\n/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n   RESPONSIVE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\n@media (max-width: 500px) {\n    .tito-widget {\n        bottom: 15px !important;\n        right: 15px !important;\n    }\n\n    .tito-toggle {\n        width: 65px !important;\n        height: 65px !important;\n    }\n\n    .tito-window {\n        width: calc(100vw - 30px) !important;\n        height: 70vh !important;\n        right: -7px !important;\n        bottom: 80px !important;\n        max-height: 550px !important;\n    }\n\n    .tito-burbuja {\n        width: 280px !important;\n        right: -7px !important;\n        bottom: 80px !important;\n    }\n\n    .tito-galeria-card {\n        width: 130px !important;\n    }\n\n    .tito-galeria-card img {\n        width: 130px !important;\n        height: 95px !important;\n    }\n}\n</style>\n\n<div class=\"tito-widget\" id=\"titoWidget\">\n    <!-- Burbuja proactiva -->\n    <div class=\"tito-burbuja\" id=\"titoBurbuja\">\n        <button class=\"tito-burbuja-close\" id=\"titoBurbujaClose\">Ã—</button>\n        <div id=\"titoBurbujaGaleria\" class=\"tito-burbuja-galeria\" style=\"display:none;\"></div>\n        <p class=\"tito-burbuja-texto\" id=\"titoBurbujaTexto\"></p>\n        <div class=\"tito-burbuja-botones\" id=\"titoBurbujaBotones\"></div>\n    </div>\n\n    <!-- BotÃ³n flotante -->\n    <button class=\"tito-toggle\" id=\"titoToggle\">\n        <img src=\"https://duendesuy.10web.cloud/wp-content/uploads/2025/12/gemini-image-2_que_tenga_un_pin_en_su_ropa_con_este_logo_en_negro_y_dorado_solo_el_circulo_que_-0_b02c570f-fd54-4b54-b306-3aa6a2b413b2-scaled.jpg\" alt=\"Tito\">\n        <span class=\"tito-notif\" id=\"titoNotif\">1</span>\n    </button>\n\n    <!-- Ventana de chat -->\n    <div class=\"tito-window\" id=\"titoWindow\">\n        <div class=\"tito-header\">\n            <div class=\"tito-avatar\">\n                <img src=\"https://duendesuy.10web.cloud/wp-content/uploads/2025/12/gemini-image-2_que_tenga_un_pin_en_su_ropa_con_este_logo_en_negro_y_dorado_solo_el_circulo_que_-0_b02c570f-fd54-4b54-b306-3aa6a2b413b2-scaled.jpg\" alt=\"Tito\">\n            </div>\n            <div class=\"tito-info\">\n                <h4>Tito</h4>\n                <p><span class=\"tito-status\"></span> GuardiÃ¡n Digital</p>\n            </div>\n            <button class=\"tito-close\" id=\"titoClose\">Ã—</button>\n        </div>\n\n        <div class=\"tito-messages\" id=\"titoMessages\"></div>\n\n        <div class=\"tito-suggestions\" id=\"titoSuggestions\">\n            <button class=\"tito-suggestion\" data-text=\"Quiero un duende de protecciÃ³n\">ProtecciÃ³n ğŸ›¡ï¸</button>\n            <button class=\"tito-suggestion\" data-text=\"Busco abundancia y prosperidad\">Abundancia ğŸ’°</button>\n            <button class=\"tito-suggestion\" data-text=\"Â¿CÃ³mo es el proceso de compra?\">Â¿CÃ³mo compro? ğŸ›’</button>\n        </div>\n\n        <div class=\"tito-input-container\">\n            <input type=\"text\" class=\"tito-input\" id=\"titoInput\" placeholder=\"EscribÃ­ tu mensaje...\" maxlength=\"500\">\n            <button class=\"tito-send\" id=\"titoSend\">â¤</button>\n        </div>\n\n        <div class=\"tito-footer\">âœ¨ Magia ancestral desde PiriÃ¡polis</div>\n    </div>\n</div>\n\n<script>\n(function() {\n    'use strict';\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // CONFIGURACIÃ“N\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    const CONFIG = {\n        API_BASE: 'https://duendes-vercel.vercel.app',\n        TITO_AVATAR: 'https://duendesuy.10web.cloud/wp-content/uploads/2025/12/gemini-image-2_que_tenga_un_pin_en_su_ropa_con_este_logo_en_negro_y_dorado_solo_el_circulo_que_-0_b02c570f-fd54-4b54-b306-3aa6a2b413b2-scaled.jpg',\n\n        // Tiempos para burbujas (ms)\n        TIEMPO_PRODUCTO: 12000,      // 12 seg en pÃ¡gina de producto\n        TIEMPO_TIENDA: 20000,        // 20 seg en tienda\n        TIEMPO_CARRITO: 8000,        // 8 seg en carrito\n        TIEMPO_CHECKOUT: 25000,      // 25 seg en checkout\n        TIEMPO_GENERAL: 30000,       // 30 seg en otras pÃ¡ginas\n        TIEMPO_ABANDONO: 60000,      // 60 seg sin actividad\n\n        // URLs\n        URL_CARRITO: '/carrito/',\n        URL_CHECKOUT: '/caja/',\n        URL_TIENDA: '/tienda/'\n    };\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // ESTADO\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    const estado = {\n        chatAbierto: false,\n        conversationHistory: [],\n        isWaiting: false,\n        visitorId: null,\n        tiempoPagina: 0,\n        ultimaActividad: Date.now(),\n        burbujasMostradas: {},\n        interactuoConTito: false,\n        paginaActual: null,\n        productoActual: null,\n        carritoItems: [],\n        carritoCount: 0\n    };\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // ELEMENTOS DOM\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    let els = {};\n\n    function initElements() {\n        els = {\n            widget: document.getElementById('titoWidget'),\n            toggle: document.getElementById('titoToggle'),\n            window: document.getElementById('titoWindow'),\n            close: document.getElementById('titoClose'),\n            messages: document.getElementById('titoMessages'),\n            input: document.getElementById('titoInput'),\n            send: document.getElementById('titoSend'),\n            suggestions: document.getElementById('titoSuggestions'),\n            notif: document.getElementById('titoNotif'),\n            burbuja: document.getElementById('titoBurbuja'),\n            burbujaTexto: document.getElementById('titoBurbujaTexto'),\n            burbujaBotones: document.getElementById('titoBurbujaBotones'),\n            burbujaGaleria: document.getElementById('titoBurbujaGaleria'),\n            burbujaClose: document.getElementById('titoBurbujaClose')\n        };\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // UTILIDADES\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function getVisitorId() {\n        let id = localStorage.getItem('tito_visitor_id');\n        if (!id) {\n            id = 'v_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n            localStorage.setItem('tito_visitor_id', id);\n        }\n        return id;\n    }\n\n    function detectarPagina() {\n        const path = window.location.pathname;\n        const body = document.body;\n\n        if (body.classList.contains('single-product') || path.includes('/producto/') || path.includes('/product/')) {\n            return 'producto';\n        }\n        if (path.includes('/carrito') || path.includes('/cart') || body.classList.contains('woocommerce-cart')) {\n            return 'carrito';\n        }\n        if (path.includes('/caja') || path.includes('/checkout') || body.classList.contains('woocommerce-checkout')) {\n            return 'checkout';\n        }\n        if (body.classList.contains('woocommerce-shop') || body.classList.contains('post-type-archive-product') ||\n            body.classList.contains('tax-product_cat') || path.includes('/tienda') || path.includes('/shop')) {\n            return 'tienda';\n        }\n        return 'general';\n    }\n\n    function obtenerProductoActual() {\n        if (estado.paginaActual !== 'producto') return null;\n\n        const titulo = document.querySelector('.product_title, .entry-title, h1.elementor-heading-title');\n        const precio = document.querySelector('.price .woocommerce-Price-amount, .price ins .amount');\n        const imagen = document.querySelector('.woocommerce-product-gallery__image img, .wp-post-image');\n\n        if (titulo) {\n            return {\n                nombre: titulo.textContent.trim(),\n                precio: precio ? precio.textContent.trim() : null,\n                imagen: imagen ? imagen.src : null,\n                url: window.location.href\n            };\n        }\n        return null;\n    }\n\n    function obtenerCarritoWoo() {\n        // Intentar obtener del localStorage de WooCommerce o del DOM\n        const carritoCount = document.querySelector('.cart-contents-count, .cart-count, .wc-block-mini-cart__badge');\n        if (carritoCount) {\n            estado.carritoCount = parseInt(carritoCount.textContent) || 0;\n        }\n\n        // Obtener items del carrito si estamos en la pÃ¡gina del carrito\n        if (estado.paginaActual === 'carrito') {\n            const items = document.querySelectorAll('.woocommerce-cart-form__cart-item, .cart_item');\n            estado.carritoItems = Array.from(items).map(item => {\n                const nombre = item.querySelector('.product-name a');\n                const precio = item.querySelector('.product-price .amount');\n                const img = item.querySelector('img');\n                return {\n                    nombre: nombre ? nombre.textContent.trim() : 'Producto',\n                    precio: precio ? precio.textContent.trim() : '',\n                    imagen: img ? img.src : null\n                };\n            });\n        }\n\n        return estado.carritoCount;\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // API CALLS\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    async function enviarMensaje(mensaje) {\n        const contexto = {\n            pagina: estado.paginaActual,\n            producto: estado.productoActual,\n            carrito: estado.carritoCount,\n            tiempoEnPagina: estado.tiempoPagina,\n            url: window.location.href\n        };\n\n        try {\n            const response = await fetch(`${CONFIG.API_BASE}/api/tito/chat`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    message: mensaje,\n                    history: estado.conversationHistory.slice(-8),\n                    contexto,\n                    visitorId: estado.visitorId\n                })\n            });\n\n            const data = await response.json();\n            return data;\n        } catch (error) {\n            console.error('Error Tito:', error);\n            return {\n                success: false,\n                response: 'DisculpÃ¡, tuve un problemita. Â¿PodÃ©s intentar de nuevo?'\n            };\n        }\n    }\n\n    async function obtenerProductosRecomendados(params = {}) {\n        try {\n            let url = `${CONFIG.API_BASE}/api/tito/woo?accion=recomendaciones`;\n            if (params.intencion) url += `&intencion=${encodeURIComponent(params.intencion)}`;\n            if (params.presupuesto) url += `&presupuesto=${params.presupuesto}`;\n\n            const response = await fetch(url);\n            const data = await response.json();\n            return data.success ? data.data : [];\n        } catch (error) {\n            console.error('Error obteniendo productos:', error);\n            return [];\n        }\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // UI - MENSAJES\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function agregarMensaje(texto, tipo, productos = []) {\n        const msg = document.createElement('div');\n        msg.className = `tito-msg ${tipo}`;\n        msg.innerHTML = texto;\n        els.messages.appendChild(msg);\n\n        // Si hay productos, agregar galerÃ­a\n        if (productos && productos.length > 0) {\n            const galeria = crearGaleria(productos);\n            els.messages.appendChild(galeria);\n        }\n\n        els.messages.scrollTop = els.messages.scrollHeight;\n    }\n\n    function crearGaleria(productos) {\n        const container = document.createElement('div');\n        container.className = 'tito-galeria';\n\n        productos.forEach(p => {\n            const card = document.createElement('a');\n            card.className = 'tito-galeria-card';\n            card.href = p.url || '#';\n            card.target = '_blank';\n            card.innerHTML = `\n                <img src=\"${p.imagen || CONFIG.TITO_AVATAR}\" alt=\"${p.nombre}\" onerror=\"this.src='${CONFIG.TITO_AVATAR}'\">\n                <div class=\"tito-galeria-info\">\n                    <p class=\"tito-galeria-nombre\">${p.nombre}</p>\n                    <p class=\"tito-galeria-precio\">$${p.precio} USD</p>\n                    <span class=\"tito-galeria-btn\">Ver guardiÃ¡n âœ¨</span>\n                </div>\n            `;\n            container.appendChild(card);\n        });\n\n        // Hint de scroll si hay mÃ¡s de 2\n        if (productos.length > 2) {\n            const hint = document.createElement('div');\n            hint.className = 'tito-galeria-hint';\n            hint.textContent = 'â† DeslizÃ¡ para ver mÃ¡s â†’';\n            container.appendChild(hint);\n        }\n\n        return container;\n    }\n\n    function mostrarTyping() {\n        const typing = document.createElement('div');\n        typing.className = 'tito-msg bot typing';\n        typing.id = 'titoTyping';\n        typing.innerHTML = '<span></span><span></span><span></span>';\n        els.messages.appendChild(typing);\n        els.messages.scrollTop = els.messages.scrollHeight;\n    }\n\n    function ocultarTyping() {\n        const typing = document.getElementById('titoTyping');\n        if (typing) typing.remove();\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // UI - BURBUJAS PROACTIVAS\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function mostrarBurbuja(config) {\n        if (estado.chatAbierto || estado.interactuoConTito) return;\n        if (els.burbuja.classList.contains('visible')) return;\n\n        // GalerÃ­a opcional\n        if (config.productos && config.productos.length > 0) {\n            els.burbujaGaleria.innerHTML = '';\n            config.productos.slice(0, 3).forEach(p => {\n                const item = document.createElement('div');\n                item.className = 'tito-burbuja-producto';\n                item.innerHTML = `\n                    <img src=\"${p.imagen || CONFIG.TITO_AVATAR}\" alt=\"${p.nombre}\" onerror=\"this.src='${CONFIG.TITO_AVATAR}'\">\n                    <div class=\"tito-burbuja-producto-nombre\">${p.nombre}</div>\n                `;\n                item.onclick = () => window.open(p.url, '_blank');\n                els.burbujaGaleria.appendChild(item);\n            });\n            els.burbujaGaleria.style.display = 'flex';\n        } else {\n            els.burbujaGaleria.style.display = 'none';\n        }\n\n        // Texto\n        els.burbujaTexto.innerHTML = config.texto;\n\n        // Botones\n        els.burbujaBotones.innerHTML = '';\n        config.botones.forEach(btn => {\n            const boton = document.createElement('button');\n            boton.className = `tito-burbuja-btn${btn.primary ? ' primary' : ''}`;\n            boton.textContent = btn.texto;\n            boton.onclick = () => {\n                ocultarBurbuja();\n                if (btn.accion === 'chat') {\n                    abrirChat();\n                    if (btn.mensaje) {\n                        setTimeout(() => {\n                            els.input.value = btn.mensaje;\n                            procesarEnvio();\n                        }, 300);\n                    }\n                } else if (btn.accion === 'url') {\n                    window.location.href = btn.url;\n                } else if (btn.accion === 'cerrar') {\n                    // Solo cerrar\n                }\n            };\n            els.burbujaBotones.appendChild(boton);\n        });\n\n        els.burbuja.classList.add('visible');\n\n        // Auto-cerrar despuÃ©s de 20 segundos\n        setTimeout(ocultarBurbuja, 20000);\n    }\n\n    function ocultarBurbuja() {\n        els.burbuja.classList.remove('visible');\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // BURBUJAS POR CONTEXTO\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    const BURBUJAS = {\n        producto: [\n            {\n                delay: 12000,\n                config: () => ({\n                    texto: `âœ¨ Este guardiÃ¡n es <strong>Ãºnico en el mundo</strong>... cuando se va, desaparece para siempre.`,\n                    botones: [\n                        { texto: 'ğŸ’œ Contame mÃ¡s', primary: true, accion: 'chat' },\n                        { texto: 'Sigo mirando', accion: 'cerrar' }\n                    ]\n                })\n            },\n            {\n                delay: 35000,\n                config: () => ({\n                    texto: `ğŸ”® Â¿SabÃ­as que cada duende tiene su propia historia y personalidad? Si sentiste algo al verlo, <strong>no es casualidad</strong>.`,\n                    botones: [\n                        { texto: 'Â¿CuÃ¡l es su historia?', primary: true, accion: 'chat', mensaje: 'Â¿CuÃ¡l es la historia de este guardiÃ¡n?' },\n                        { texto: 'DespuÃ©s', accion: 'cerrar' }\n                    ]\n                })\n            },\n            {\n                delay: 70000,\n                config: () => ({\n                    texto: `ğŸ’« Â¿El precio es un obstÃ¡culo? Con solo el <strong>30% lo reservÃ¡s por 30 dÃ­as</strong>...`,\n                    botones: [\n                        { texto: 'Â¿CÃ³mo funciona?', primary: true, accion: 'chat', mensaje: 'Â¿CÃ³mo funciona el sistema de seÃ±a?' },\n                        { texto: 'No, gracias', accion: 'cerrar' }\n                    ]\n                })\n            }\n        ],\n\n        tienda: [\n            {\n                delay: 20000,\n                config: async () => {\n                    const productos = await obtenerProductosRecomendados({});\n                    return {\n                        texto: `ğŸ”® Â¿BuscÃ¡s algo especÃ­fico? Puedo ayudarte a encontrar el guardiÃ¡n <strong>perfecto para vos</strong>.`,\n                        productos: productos.slice(0, 3),\n                        botones: [\n                            { texto: 'SÃ­, ayudame', primary: true, accion: 'chat' },\n                            { texto: 'Solo miro', accion: 'cerrar' }\n                        ]\n                    };\n                }\n            },\n            {\n                delay: 50000,\n                config: () => ({\n                    texto: `âœ¨ Â¿ProtecciÃ³n, abundancia, amor o sanaciÃ³n? Cada guardiÃ¡n tiene un propÃ³sito especial...`,\n                    botones: [\n                        { texto: 'ğŸ›¡ï¸ ProtecciÃ³n', accion: 'chat', mensaje: 'Busco un guardiÃ¡n de protecciÃ³n' },\n                        { texto: 'ğŸ’° Abundancia', accion: 'chat', mensaje: 'Busco un guardiÃ¡n de abundancia' },\n                        { texto: 'ğŸ’œ Amor', accion: 'chat', mensaje: 'Busco un guardiÃ¡n de amor' }\n                    ]\n                })\n            }\n        ],\n\n        carrito: [\n            {\n                delay: 8000,\n                config: () => ({\n                    texto: `ğŸ€ Â¡Excelente elecciÃ³n! Tus guardianes ya estÃ¡n ansiosos por conocerte...`,\n                    botones: [\n                        { texto: 'ğŸ›’ Completar compra', primary: true, accion: 'url', url: CONFIG.URL_CHECKOUT },\n                        { texto: 'Tengo dudas', accion: 'chat' }\n                    ]\n                })\n            },\n            {\n                delay: 40000,\n                config: () => ({\n                    texto: `âš¡ RecordÃ¡: son piezas <strong>Ãºnicas</strong>. Si alguien mÃ¡s las adopta mientras tanto, desaparecen para siempre...`,\n                    botones: [\n                        { texto: 'Voy a pagar', primary: true, accion: 'url', url: CONFIG.URL_CHECKOUT },\n                        { texto: 'Â¿Puedo reservar?', accion: 'chat', mensaje: 'Â¿Puedo reservar con una seÃ±a?' }\n                    ]\n                })\n            }\n        ],\n\n        checkout: [\n            {\n                delay: 25000,\n                config: () => ({\n                    texto: `ğŸ“ Â¿Todo bien con el formulario? Estoy acÃ¡ si necesitÃ¡s ayuda.`,\n                    botones: [\n                        { texto: 'Tengo una duda', primary: true, accion: 'chat' },\n                        { texto: 'Todo bien', accion: 'cerrar' }\n                    ]\n                })\n            }\n        ],\n\n        general: [\n            {\n                delay: 30000,\n                config: () => ({\n                    texto: `âœ¨ Â¡Hola! Soy Tito, el guardiÃ¡n digital. Si llegaste hasta acÃ¡, <strong>no es casualidad</strong>...`,\n                    botones: [\n                        { texto: 'Contame mÃ¡s', primary: true, accion: 'chat' },\n                        { texto: 'Ver tienda', accion: 'url', url: CONFIG.URL_TIENDA }\n                    ]\n                })\n            }\n        ]\n    };\n\n    function iniciarBurbujas() {\n        const burbujas = BURBUJAS[estado.paginaActual] || BURBUJAS.general;\n\n        burbujas.forEach((burbuja, index) => {\n            const key = `${estado.paginaActual}_${index}`;\n            if (estado.burbujasMostradas[key]) return;\n\n            setTimeout(async () => {\n                if (estado.chatAbierto || estado.interactuoConTito) return;\n                if (estado.burbujasMostradas[key]) return;\n\n                estado.burbujasMostradas[key] = true;\n\n                const config = typeof burbuja.config === 'function'\n                    ? await burbuja.config()\n                    : burbuja.config;\n\n                mostrarBurbuja(config);\n            }, burbuja.delay);\n        });\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // DETECCIÃ“N DE ABANDONO\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function iniciarDeteccionAbandono() {\n        let abandonoTimeout = null;\n\n        function resetearAbandono() {\n            estado.ultimaActividad = Date.now();\n            if (abandonoTimeout) clearTimeout(abandonoTimeout);\n\n            abandonoTimeout = setTimeout(() => {\n                if (estado.carritoCount > 0 && !estado.chatAbierto && !estado.interactuoConTito) {\n                    mostrarBurbuja({\n                        texto: `ğŸ’­ Â¿Te fuiste? Tus guardianes siguen esperÃ¡ndote... No dejes que otro los adopte ğŸ€`,\n                        botones: [\n                            { texto: 'Ver mi carrito', primary: true, accion: 'url', url: CONFIG.URL_CARRITO },\n                            { texto: 'Tengo dudas', accion: 'chat' }\n                        ]\n                    });\n                }\n            }, CONFIG.TIEMPO_ABANDONO);\n        }\n\n        // Eventos de actividad\n        ['mousemove', 'keydown', 'scroll', 'click', 'touchstart'].forEach(event => {\n            document.addEventListener(event, resetearAbandono, { passive: true });\n        });\n\n        resetearAbandono();\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // CHAT HANDLERS\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function abrirChat() {\n        estado.chatAbierto = true;\n        els.window.classList.add('visible');\n        ocultarBurbuja();\n        els.notif.style.display = 'none';\n        els.input.focus();\n\n        // Mensaje de bienvenida si es primera vez\n        if (estado.conversationHistory.length === 0) {\n            const saludo = estado.paginaActual === 'producto' && estado.productoActual\n                ? `Â¡Hola! Veo que estÃ¡s mirando a <strong>${estado.productoActual.nombre}</strong>... Â¿QuerÃ©s que te cuente sobre este guardiÃ¡n? ğŸ€`\n                : 'Â¡Hola! Soy Tito, el guardiÃ¡n digital de Duendes del Uruguay. Â¿En quÃ© puedo ayudarte hoy? âœ¨';\n\n            agregarMensaje(saludo, 'bot');\n        }\n    }\n\n    function cerrarChat() {\n        estado.chatAbierto = false;\n        els.window.classList.remove('visible');\n    }\n\n    async function procesarEnvio() {\n        const mensaje = els.input.value.trim();\n        if (!mensaje || estado.isWaiting) return;\n\n        estado.interactuoConTito = true;\n        estado.isWaiting = true;\n        els.send.disabled = true;\n        els.input.value = '';\n        els.suggestions.style.display = 'none';\n\n        // Agregar mensaje del usuario\n        agregarMensaje(mensaje, 'user');\n        estado.conversationHistory.push({ role: 'user', content: mensaje });\n\n        // Mostrar typing\n        mostrarTyping();\n\n        // Enviar a la API\n        const response = await enviarMensaje(mensaje);\n\n        ocultarTyping();\n\n        if (response.success) {\n            agregarMensaje(response.response, 'bot', response.productos);\n            estado.conversationHistory.push({ role: 'assistant', content: response.response });\n        } else {\n            agregarMensaje(response.response || 'DisculpÃ¡, tuve un problemita. Â¿PodÃ©s intentar de nuevo?', 'bot');\n        }\n\n        estado.isWaiting = false;\n        els.send.disabled = false;\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // EVENT LISTENERS\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function initEventListeners() {\n        // Toggle chat\n        els.toggle.onclick = () => {\n            if (estado.chatAbierto) {\n                cerrarChat();\n            } else {\n                abrirChat();\n            }\n        };\n\n        // Cerrar chat\n        els.close.onclick = cerrarChat;\n\n        // Cerrar burbuja\n        els.burbujaClose.onclick = ocultarBurbuja;\n\n        // Enviar mensaje\n        els.send.onclick = procesarEnvio;\n\n        els.input.onkeypress = (e) => {\n            if (e.key === 'Enter') procesarEnvio();\n        };\n\n        // Sugerencias\n        document.querySelectorAll('.tito-suggestion').forEach(btn => {\n            btn.onclick = () => {\n                els.input.value = btn.dataset.text;\n                procesarEnvio();\n            };\n        });\n\n        // Cerrar al hacer click fuera\n        document.addEventListener('click', (e) => {\n            if (estado.chatAbierto && !els.widget.contains(e.target)) {\n                cerrarChat();\n            }\n        });\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // SINCRONIZACIÃ“N CON WOOCOMMERCE\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function syncWooCommerce() {\n        // Escuchar eventos de WooCommerce\n        if (typeof jQuery !== 'undefined') {\n            jQuery(document.body).on('added_to_cart', function(e, fragments, cart_hash, button) {\n                estado.carritoCount++;\n                els.toggle.classList.add('cart-added');\n                setTimeout(() => els.toggle.classList.remove('cart-added'), 600);\n\n                // Mostrar notificaciÃ³n\n                els.notif.textContent = '1';\n                els.notif.style.display = 'flex';\n\n                // Burbuja de confirmaciÃ³n\n                setTimeout(() => {\n                    if (!estado.chatAbierto) {\n                        mostrarBurbuja({\n                            texto: `ğŸ‰ Â¡GuardiÃ¡n agregado al carrito! Â¿QuerÃ©s completar la adopciÃ³n?`,\n                            botones: [\n                                { texto: 'Ir al carrito', primary: true, accion: 'url', url: CONFIG.URL_CARRITO },\n                                { texto: 'Seguir mirando', accion: 'cerrar' }\n                            ]\n                        });\n                    }\n                }, 500);\n            });\n\n            jQuery(document.body).on('removed_from_cart', function() {\n                estado.carritoCount = Math.max(0, estado.carritoCount - 1);\n            });\n        }\n\n        // Sincronizar conteo inicial\n        obtenerCarritoWoo();\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // CONTADOR DE TIEMPO EN PÃGINA\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function iniciarContadorTiempo() {\n        setInterval(() => {\n            estado.tiempoPagina++;\n        }, 1000);\n    }\n\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n    // INIT\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n    function init() {\n        // Esperar a que el DOM estÃ© listo\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', init);\n            return;\n        }\n\n        console.log('ğŸ€ Tito Ã‰pico v4.0 iniciando...');\n\n        // Inicializar\n        initElements();\n\n        estado.visitorId = getVisitorId();\n        estado.paginaActual = detectarPagina();\n        estado.productoActual = obtenerProductoActual();\n\n        console.log('ğŸ€ PÃ¡gina detectada:', estado.paginaActual);\n        if (estado.productoActual) {\n            console.log('ğŸ€ Producto:', estado.productoActual.nombre);\n        }\n\n        initEventListeners();\n        syncWooCommerce();\n        iniciarContadorTiempo();\n        iniciarBurbujas();\n        iniciarDeteccionAbandono();\n\n        console.log('ğŸ€ Tito listo!');\n    }\n\n    // Ejecutar\n    init();\n\n})();\n</script>\n",
    "code_type": "html",
    "location": "site_wide_footer",
    "active": true,
    "note": "Widget unificado de Tito con: productos con fotos, burbujas proactivas, detecciÃ³n de abandono, conexiÃ³n WooCommerce. IMPORTANTE: Desactivar los snippets anteriores de Tito (IDs: 3625, 3649, 3777)"
  }
]
